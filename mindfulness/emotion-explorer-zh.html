<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç»ªæ¢ç´¢å™¨ - Emotion Explorer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --power-color: #FF0000;
            --possession-color: #00FF00;
            --loss-color: #FF00FF;
            --emptiness-color: #FFFF00;
            --crave-color: #0000FF;
            --empathy-color: #00FFFF;
        }

        .explorer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .explorer-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
        }

        .explorer-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }

        .explorer-header p {
            color: #64748b;
            font-size: 1rem;
        }

        #emotionRibbonDisplay {
            background-color: #f0f0f0;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        #emotionRainbowSvg {
            width: 100%;
            height: 120px;
            margin: 0 auto;
        }

        .categories-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .category-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-tab.active {
            border-color: var(--power-color);
            background: var(--power-color);
            color: white;
        }

        .category-tab[data-category="POWER"] { border-color: var(--power-color); }
        .category-tab[data-category="POWER"].active { background: var(--power-color); }
        
        .category-tab[data-category="POSSESSION"] { border-color: var(--possession-color); color: #333; }
        .category-tab[data-category="POSSESSION"].active { background: var(--possession-color); }
        
        .category-tab[data-category="LOSS"] { border-color: var(--loss-color); }
        .category-tab[data-category="LOSS"].active { background: var(--loss-color); }
        
        .category-tab[data-category="EMPTINESS"] { border-color: var(--emptiness-color); }
        .category-tab[data-category="EMPTINESS"].active { background: var(--emptiness-color); }
        
        .category-tab[data-category="CRAVE"] { border-color: var(--crave-color); }
        .category-tab[data-category="CRAVE"].active { background: var(--crave-color); }
        
        .category-tab[data-category="EMPATHY"] { border-color: var(--empathy-color); }
        .category-tab[data-category="EMPATHY"].active { background: var(--empathy-color); }

        .words-display-area {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            min-height: 200px;
        }

        .words-category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .words-category-emoji {
            font-size: 2rem;
        }

        .words-category-info h3 {
            margin: 0;
            color: #1e293b;
            font-size: 1.25rem;
        }

        .words-category-info p {
            margin: 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .words-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .word-bubble {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .word-bubble:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .word-bubble.selected {
            border-color: var(--power-color);
            background: var(--power-color);
            color: white;
        }

        .selected-words-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .selected-words-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .selected-words-header h3 {
            margin: 0;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .clear-all-btn {
            padding: 0.5rem 1rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s ease;
        }

        .clear-all-btn:hover {
            background: #dc2626;
        }

        .selected-words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 2rem;
        }

        .selected-word-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            color: white;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .selected-word-tag:hover {
            opacity: 0.8;
        }

        .selected-word-tag .remove {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .stats-bar {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.25rem;
        }

        /* Navigation Bar */
        .nav-bar {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-family: 'Crimson Text', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-primary);
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            overflow-x: visible;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }

        .tools-dropdown-container {
            position: relative;
            display: inline-block;
        }

        .tools-dropdown-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .tools-dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #1e293b;
        }

        .tools-dropdown-btn.active {
            background: var(--color-primary);
            color: white;
        }

        .tools-dropdown-menu {
            display: none;
            position: fixed;
            top: auto;
            left: auto;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 220px;
            padding: 0.5rem;
            z-index: 1001;
        }

        .tools-dropdown-menu.open {
            display: block;
        }

        .tools-dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #1e293b;
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tools-dropdown-menu a:hover {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #64748b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .mobile-menu-btn:hover {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }

        @media (max-width: 1024px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 60px;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 10px 40px rgba(0,0,0,0.1);
                z-index: 999;
                gap: 0.5rem;
            }

            .nav-links.show {
                display: flex;
            }

            .nav-bar {
                position: relative;
            }

            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Full Navigation Bar -->
    <nav class="nav-bar">
        <div class="nav-brand" onclick="window.location.href='index.html'">ğŸ§˜ æ­£å¿µç–—æ³•</div>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="nav-links" id="navLinks">
            <button class="nav-btn" onclick="window.location.href='emotion-explorer.html'">English</button>
            <button class="nav-btn" onclick="window.location.href='emotion-explorer-ru.html'">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
            <button class="nav-btn" onclick="window.location.href='index.html'">é¦–é¡µ</button>
            <button class="nav-btn" onclick="window.location.href='emotion-balance.html'">æƒ…ç»ªå¹³è¡¡</button>

            <!-- Tools Dropdown -->
            <div class="tools-dropdown-container" id="toolsContainer">
                <button class="tools-dropdown-btn" id="toolsBtn" type="button" onclick="toggleToolsMenu();">
                    å·¥å…· <i class="fas fa-chevron-down" style="font-size: 0.75rem;"></i>
                </button>
                <div class="tools-dropdown-menu" id="toolsMenu">
                    <a href="breathing.html" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; border-radius: 0.5rem; white-space: nowrap;">ğŸ« å‘¼å¸ç»ƒä¹ </a>
                    <a href="meditation.html" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; border-radius: 0.5rem; white-space: nowrap;">ğŸ§˜ å†¥æƒ³æŒ‡å¯¼</a>
                    <a href="journal.html" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; border-radius: 0.5rem; white-space: nowrap;">ğŸ“– æƒ…ç»ªæ—¥è®°</a>
                    <a href="cognitive-reframe.html" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; border-radius: 0.5rem; white-space: nowrap;">ğŸ”„ è®¤çŸ¥é‡æ„</a>
                    <a href="emotional-salad.html" onclick="closeToolsDropdown();" style="display: block; padding: 0.75rem 1rem; color: #1e293b; text-decoration: none; border-radius: 0.5rem; white-space: nowrap;">ğŸ¥— æƒ…ç»ªæ²™æ‹‰</a>
                </div>
            </div>

            <button class="nav-btn" onclick="window.location.href='../index.html'">è¿”å›æ²»ç–—åº”ç”¨</button>
        </div>
    </nav>

    <div class="explorer-container">
        <div class="explorer-header">
            <h1>æƒ…ç»ªæ¢ç´¢å™¨</h1>
            <p>é€‰æ‹©æƒ…ç»ªè¯è¯­ï¼Œè§‚å¯Ÿå½©è™¹çš„å˜åŒ–</p>
        </div>

        <!-- Emotion Ribbon Display -->
        <div id="emotionRibbonDisplay">
            <svg id="emotionRainbowSvg" viewBox="0 0 1200 120">
                <!-- Rainbow bands for complementary pairs -->
                <path id="rainbow-pair-1" d="M 0,120 A 600,100 0 0 1 1200,120" fill="transparent" stroke="none"/>
                <path id="rainbow-pair-2" d="M 50,120 A 550,90 0 0 1 1150,120" fill="transparent" stroke="none"/>
                <path id="rainbow-pair-3" d="M 100,120 A 500,80 0 0 1 1100,120" fill="transparent" stroke="none"/>
            </svg>
        </div>

        <!-- Category Tabs -->
        <div class="categories-tabs">
            <button class="category-tab active" data-category="POWER" onclick="switchTab('POWER')">ğŸ’ª æƒåŠ›</button>
            <button class="category-tab" data-category="POSSESSION" onclick="switchTab('POSSESSION')">ğŸ  å æœ‰</button>
            <button class="category-tab" data-category="LOSS" onclick="switchTab('LOSS')">ğŸ’” å¤±å»</button>
            <button class="category-tab" data-category="EMPTINESS" onclick="switchTab('EMPTINESS')">â­• ç©ºè™š</button>
            <button class="category-tab" data-category="CRAVE" onclick="switchTab('CRAVE')">ğŸ”¥ æ¸´æœ›</button>
            <button class="category-tab" data-category="EMPATHY" onclick="switchTab('EMPATHY')">ğŸ¤ å…±æƒ…</button>
        </div>

        <!-- Words Display Area -->
        <div class="words-display-area" id="wordsDisplayArea">
            <p style="text-align: center; color: #94a3b8; padding: 2rem;">æ­£åœ¨åŠ è½½è¯è¯­...</p>
        </div>

        <!-- Selected Words Section -->
        <div class="selected-words-section">
            <div class="selected-words-header">
                <h3>å·²é€‰æ‹©çš„è¯è¯­</h3>
                <button class="clear-all-btn" onclick="clearAllWords()">æ¸…é™¤å…¨éƒ¨</button>
            </div>
            <div class="selected-words-list" id="selectedWordsList">
                <span style="color: #94a3b8; font-size: 0.875rem;">å°šæœªé€‰æ‹©è¯è¯­...</span>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalSelected">0</div>
                <div class="stat-label">å·²é€‰æ‹©</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="categoriesActive">0</div>
                <div class="stat-label">æ´»è·ƒç±»åˆ«</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="dominantCategory">-</div>
                <div class="stat-label">ä¸»å¯¼ç±»åˆ«</div>
            </div>
        </div>
    </div>

    <script>
        // Inline EmotionRibbon lexicon to ensure it loads
        const EmotionRibbon = {
            lexicon: {
                POWER: ['å¼ºå¤§', 'æœ‰åŠ›', 'åŠ›é‡', 'ä¸»å¯¼', 'æƒå¨', 'æ§åˆ¶', 'æŒæ§', 'é¢†å¯¼', 'è‡ªä¿¡', 'èƒ½åŠ›', 'èƒœåˆ©', 'æˆåŠŸ', 'å‹‡æ°”', 'å‹‡æ•¢', 'èƒ½é‡', 'æ´»åŠ›', 'æˆå°±', 'é›„å¿ƒ', 'å“è¶Š', 'è‹±é›„', 'å† å†›', 'å¾æœ', 'ä¼˜åŠ¿', 'åšå®š', 'æœæ–­', 'å½±å“åŠ›', 'æŒæ§åŠ›', 'å®åŠ›', 'å¼ºåŠ¿', 'å¨æ­¦', 'æ¿€åŠ¨', 'å¼€å¿ƒ', 'ä¹è§‚', 'å‰è¿›', 'å¯èƒ½'],
                POSSESSION: ['æ‹¥æœ‰', 'å æœ‰', 'è·å¾—', 'å¾—åˆ°', 'æ”¶è—', 'ç§¯ç´¯', 'è´¢å¯Œ', 'è´¢äº§', 'èµ„äº§', 'èµ„æº', 'å½’å±', 'æˆ‘çš„', 'æŒæœ‰', 'ä¿ç•™', 'å®ˆæŠ¤', 'çæƒœ', 'é‡è§†', 'çœ‹é‡', 'åœ¨æ„', 'ä¾æ‹', 'ä¾èµ–', 'ä¾é ', 'å¯„æ‰˜', 'å®‰å¿ƒ', 'ç¨³å®š', 'å®‰å…¨', 'æ»¡è¶³', 'å……å®', 'ä¸°å¯Œ', 'å……è£•'],
                LOSS: ['å¤±å»', 'å¤±è½', 'ä¸§å¤±', 'ç¦»åˆ«', 'åˆ†ç¦»', 'å‘Šåˆ«', 'ç»“æŸ', 'ç»ˆæ­¢', 'æ¶ˆå¤±', 'é€å»', 'é—æ†¾', 'åæ‚”', 'æƒ‹æƒœ', 'æ‚²ä¼¤', 'å“€ç—›', 'ç—›è‹¦', 'å¿ƒç¢', 'å—ä¼¤', 'åˆ›ä¼¤', 'æ‰“å‡»', 'æŒ«æŠ˜', 'å¤±è´¥', 'è·Œå€’', 'æ²‰æ²¦', 'æ²®ä¸§', 'ç»æœ›', 'æ— åŠ©', 'å­¤ç‹¬', 'ç©ºè™š', 'è¿·èŒ«'],
                EMPTINESS: ['ç©ºè™š', 'ç©ºæ´', 'ç©ºç™½', 'ç¼ºå¤±', 'ç¼ºä¹', 'ä¸è¶³', 'è´«ä¹', 'åŒ®ä¹', 'é¥¥é¥¿', 'æ¸´æœ›', 'éœ€è¦', 'æƒ³è¦', 'è¿½æ±‚', 'å¯»æ‰¾', 'æ¢ç´¢', 'è¿·èŒ«', 'å›°æƒ‘', 'è¿·å¤±', 'æ¼‚æ³Š', 'æµæµª', 'æ— æ ¹', 'æµ®åŠ¨', 'ä¸ç¡®å®š', 'ä¸å®‰', 'ç„¦è™‘', 'ç´§å¼ ', 'æ‹…å¿ƒ', 'å¿§è™‘', 'çƒ¦èº', 'èºåŠ¨'],
                CRAVE: ['æ¸´æœ›', 'æ¬²æœ›', 'æ¸´æ±‚', 'å‘å¾€', 'æ†§æ†¬', 'æœŸå¾…', 'ç›¼æœ›', 'å¸Œæœ›', 'æ¢¦æƒ³', 'å¹»æƒ³', 'è¿·æ‹', 'ç—´è¿·', 'ç€è¿·', 'çƒ­è¡·', 'çƒ­çˆ±', 'å–œçˆ±', 'å–œæ¬¢', 'æ¬£èµ', 'èµç¾', 'ç¾¡æ…•', 'å«‰å¦’', 'ç«äº‰', 'äº‰å¼º', 'å¥½èƒœ', 'é‡å¿ƒ', 'æŠ±è´Ÿ', 'å¿—å‘', 'ç†æƒ³', 'ç›®æ ‡', 'è¿½æ±‚'],
                EMPATHY: ['å…±æƒ…', 'åŒç†', 'ç†è§£', 'ä½“è°…', 'åŒ…å®¹', 'æ¥çº³', 'å®½æ•', 'åŸè°…', 'æ…ˆæ‚²', 'å–„è‰¯', 'æ¸©æš–', 'å…³æ€€', 'å…³å¿ƒ', 'ç…§é¡¾', 'å‘µæŠ¤', 'æ”¯æŒ', 'é¼“åŠ±', 'å®‰æ…°', 'é™ªä¼´', 'å€¾å¬', 'è¿æ¥', 'äº²å¯†', 'ä¿¡ä»»', 'çœŸè¯š', 'è¯šå®', 'æ•å¼€', 'è„†å¼±', 'çœŸå®', 'è‡ªç„¶', 'å¹³å’Œ']
            }
        };
        window.EmotionRibbon = EmotionRibbon;
    </script>
    <script>
        // Selected words state
        let selectedWords = [];
        let currentTab = 'POWER';

        // Category data
        const categories = {
            POWER: { name: 'æƒåŠ›', emoji: 'ğŸ’ª', color: '#FF0000' },
            POSSESSION: { name: 'å æœ‰', emoji: 'ğŸ ', color: '#00FF00' },
            LOSS: { name: 'å¤±å»', emoji: 'ğŸ’”', color: '#FF00FF' },
            EMPTINESS: { name: 'ç©ºè™š', emoji: 'â­•', color: '#FFFF00' },
            CRAVE: { name: 'æ¸´æœ›', emoji: 'ğŸ”¥', color: '#0000FF' },
            EMPATHY: { name: 'å…±æƒ…', emoji: 'ğŸ¤', color: '#00FFFF' }
        };

        // Rainbow color mapping - äº’è¡¥è‰²å¯¹
        // çº¢è‰² (255,0,0) + é’è‰² (0,255,255) = ç™½è‰²
        // ç»¿è‰² (0,255,0) + å“çº¢è‰² (255,0,255) = ç™½è‰²
        // è“è‰² (0,0,255) + é»„è‰² (255,255,0) = ç™½è‰²
        const rainbowColors = {
            POWER: '#FF0000',      // çº¢è‰²
            EMPATHY: '#00FFFF',    // é’è‰² (çº¢è‰²çš„äº’è¡¥è‰²)
            POSSESSION: '#00FF00', // ç»¿è‰²
            LOSS: '#FF00FF',       // å“çº¢è‰² (ç»¿è‰²çš„äº’è¡¥è‰²)
            CRAVE: '#0000FF',      // è“è‰²
            EMPTINESS: '#FFFF00'   // é»„è‰² (è“è‰²çš„äº’è¡¥è‰²)
        };

        // ç±»åˆ«é…å¯¹
        const categoryToBand = {
            POWER: 'pair-1',
            EMPATHY: 'pair-1',
            POSSESSION: 'pair-2',
            LOSS: 'pair-2',
            CRAVE: 'pair-3',
            EMPTINESS: 'pair-3'
        };

        // Initialize
        function init() {
            console.log('Initializing...');
            console.log('EmotionRibbon available:', !!window.EmotionRibbon);
            console.log('Lexicon available:', !!window.EmotionRibbon?.lexicon);
            
            if (window.EmotionRibbon && window.EmotionRibbon.lexicon) {
                console.log('Categories:', Object.keys(window.EmotionRibbon.lexicon));
                switchTab('POWER');
                updateUI();
            } else {
                console.log('EmotionRibbon not loaded');
                document.getElementById('wordsDisplayArea').innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢</p>';
            }
        }

        // Switch tab
        function switchTab(category) {
            currentTab = category;
            
            // Update active tab
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            displayWordsForCategory(category);
        }

        // Display words for category
        function displayWordsForCategory(categoryKey) {
            const displayArea = document.getElementById('wordsDisplayArea');
            const category = categories[categoryKey];
            
            if (!window.EmotionRibbon || !window.EmotionRibbon.lexicon) {
                displayArea.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">è¯è¯­åº“æœªåŠ è½½</p>';
                return;
            }
            
            const words = window.EmotionRibbon.lexicon[categoryKey] || [];
            
            if (words.length === 0) {
                displayArea.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 2rem;">æ­¤ç±»åˆ«æš‚æ— è¯è¯­</p>';
                return;
            }
            
            displayArea.innerHTML = `
                <div class="words-category-header">
                    <div class="words-category-emoji">${category.emoji}</div>
                    <div class="words-category-info">
                        <h3>${category.name}</h3>
                        <p>${words.length} ä¸ªè¯è¯­ â€¢ ç‚¹å‡»é€‰æ‹©</p>
                    </div>
                </div>
                <div class="words-cloud">
                    ${words.map(word => {
                        const isSelected = selectedWords.some(w => w.word === word && w.category === categoryKey);
                        return `<button class="word-bubble ${isSelected ? 'selected' : ''}" onclick="toggleWord('${word}', '${categoryKey}')">${word}</button>`;
                    }).join('')}
                </div>
            `;
        }

        // Toggle word selection
        function toggleWord(word, category) {
            const existingIndex = selectedWords.findIndex(w => w.word === word && w.category === category);
            
            if (existingIndex >= 0) {
                selectedWords.splice(existingIndex, 1);
            } else {
                selectedWords.push({ word, category });
            }
            
            updateUI();
        }

        // Update UI
        function updateUI() {
            displayWordsForCategory(currentTab);
            updateSelectedWordsList();
            updateRibbon();
            updateStats();
        }

        // Update selected words list
        function updateSelectedWordsList() {
            const list = document.getElementById('selectedWordsList');
            
            if (selectedWords.length === 0) {
                list.innerHTML = '<span style="color: #94a3b8; font-size: 0.875rem;">å°šæœªé€‰æ‹©è¯è¯­...</span>';
                return;
            }
            
            list.innerHTML = selectedWords.map(word => {
                const color = rainbowColors[word.category];
                return `<span class="selected-word-tag" style="background: ${color};" onclick="toggleWord('${word.word}', '${word.category}')">${word.word} <i class="fas fa-times remove"></i></span>`;
            }).join('');
        }

        // Update ribbon
        function updateRibbon() {
            const rainbowBands = document.querySelectorAll('#emotionRainbowSvg path');
            rainbowBands.forEach(band => band.setAttribute('fill', 'transparent'));
            
            if (selectedWords.length === 0) return;
            
            const activeCategories = new Set(selectedWords.map(w => w.category));
            const categoryCounts = {};
            selectedWords.forEach(w => {
                categoryCounts[w.category] = (categoryCounts[w.category] || 0) + 1;
            });
            
            const bandPairs = [
                { band: 'pair-1', categories: ['POWER', 'EMPATHY'] },
                { band: 'pair-2', categories: ['POSSESSION', 'LOSS'] },
                { band: 'pair-3', categories: ['CRAVE', 'EMPTINESS'] }
            ];
            
            bandPairs.forEach(pair => {
                const band = document.getElementById(`rainbow-${pair.band}`);
                if (!band) return;
                
                const activeInPair = pair.categories.filter(cat => activeCategories.has(cat));
                
                if (activeInPair.length === 1) {
                    const color = rainbowColors[activeInPair[0]];
                    const count = categoryCounts[activeInPair[0]] || 0;
                    const opacity = Math.min(count / 5, 1);
                    band.setAttribute('fill', color);
                    band.setAttribute('fill-opacity', opacity);
                } else if (activeInPair.length === 2) {
                    const color1 = rainbowColors[activeInPair[0]];
                    const color2 = rainbowColors[activeInPair[1]];
                    const count1 = categoryCounts[activeInPair[0]] || 0;
                    const count2 = categoryCounts[activeInPair[1]] || 0;
                    const totalIntensity = Math.min((count1 + count2) / 10, 1);
                    
                    band.setAttribute('fill', '#FFFFFF');
                    band.setAttribute('fill-opacity', totalIntensity);
                }
            });
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalSelected').textContent = selectedWords.length;
            
            const activeCategories = new Set(selectedWords.map(w => w.category));
            document.getElementById('categoriesActive').textContent = activeCategories.size;
            
            if (selectedWords.length > 0) {
                const categoryCounts = {};
                selectedWords.forEach(w => {
                    categoryCounts[w.category] = (categoryCounts[w.category] || 0) + 1;
                });
                const dominant = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1])[0][0];
                document.getElementById('dominantCategory').textContent = categories[dominant].name;
            } else {
                document.getElementById('dominantCategory').textContent = '-';
            }
        }

        // Clear all words
        function clearAllWords() {
            selectedWords = [];
            updateUI();
        }

        // Tools dropdown functions
        function toggleToolsMenu() {
            const menu = document.getElementById('toolsMenu');
            const btn = document.getElementById('toolsBtn');
            
            if (menu.classList.contains('open')) {
                menu.classList.remove('open');
                btn.classList.remove('active');
            } else {
                menu.classList.add('open');
                btn.classList.add('active');
                
                const btnRect = btn.getBoundingClientRect();
                menu.style.top = (btnRect.bottom + 8) + 'px';
                menu.style.left = btnRect.left + 'px';
            }
        }

        function closeToolsDropdown() {
            document.getElementById('toolsMenu').classList.remove('open');
            document.getElementById('toolsBtn').classList.remove('active');
        }

        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const container = document.getElementById('toolsContainer');
            const menu = document.getElementById('toolsMenu');
            const btn = document.getElementById('toolsBtn');
            
            if (!container.contains(event.target)) {
                menu.classList.remove('open');
                btn.classList.remove('active');
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>