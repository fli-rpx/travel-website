<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="copyright" content="¬© 2026 Mindfulness Therapy. All rights reserved.">
    <meta name="author" content="Mindfulness Therapy">
    <title>Mindfulness Therapy - Emotional Balancing</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="emotion-ribbon.js"></script>
    <script src="emotion-ribbon-visualizer.js"></script>
    <style>
        /* Fixed dropdown styles */
        .tools-dropdown-container {
            position: relative;
            display: inline-block;
        }
        
        .tools-dropdown-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-family: inherit;
        }
        
        .tools-dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #1e293b;
        }
        
        .tools-dropdown-btn.active {
            background: #14b8a6;
            color: white;
        }
        
        .tools-dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 0.5rem;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid #e2e8f0;
            min-width: 220px;
            padding: 0.5rem;
            z-index: 9999;
        }
        
        .tools-dropdown-menu.open {
            display: block;
        }
        
        .tools-dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #1e293b;
            text-decoration: none;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        .tools-dropdown-menu a:hover {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Fixed Table of Contents -->
        <nav class="toc-fixed">
            <h3>Contents</h3>
            <ul>
                <li><a href="#" onclick="app.navigate('home')">Home</a></li>
                <li><a href="#" onclick="app.navigate('cycle')">Power-Possession Cycle</a></li>
                <li><a href="#" onclick="app.navigate('assessment')">AI Assessment</a></li>
                <li><a href="emotion-explorer.html">üé® Emotion Explorer</a></li>
                <li><a href="emotion-balance.html">‚ö° Emotion Balance</a></li>
                <li><a href="#" onclick="app.navigate('salad')">Salad Check</a></li>
                <li><a href="salad-compass.html">ü•ó Salad Compass</a></li>
                <li><a href="#" onclick="app.navigate('interventions')">Interventions</a></li>
                <li><a href="#" onclick="app.navigate('journal')">Journal</a></li>
                <li><a href="#" onclick="app.navigate('progress')">Progress</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <div class="content-main">
            <!-- Navigation Bar -->
            <nav class="nav-bar">
                <div class="nav-brand" onclick="app.navigate('home')" style="cursor: pointer;">üßò Mindfulness Therapy</div>
                <button class="mobile-menu-btn" onclick="app.toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-links" id="navLinks">
                    <button class="nav-btn" onclick="window.location.href='index-zh.html'">‰∏≠Êñá</button>
                    <button class="nav-btn active" data-tab="home">Home</button>
                    <button class="nav-btn" data-tab="cycle">Cycle</button>
                    <button class="nav-btn" data-tab="assessment">AI Chat</button>
                    
                    <!-- Tools Dropdown - Completely separate from app.js -->
                    <div class="tools-dropdown-container" id="toolsContainer">
                        <button class="tools-dropdown-btn" id="toolsBtn" type="button" onclick="toggleToolsMenu();">
                            Tools <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="tools-dropdown-menu" id="toolsMenu" style="display: block !important; position: fixed; top: 100px; left: 100px; z-index: 999999; background: red; border: 5px solid black; padding: 20px; width: 200px; height: 200px; color: white; font-size: 20px; font-weight: bold;">
                            <p style="color: white; font-size: 24px; margin: 0;">TOOLS MENU</p>
                            <a href="emotion-explorer.html" style="color: white; display: block; margin: 10px 0;">üé® Emotion Explorer</a>
                            <a href="emotion-balance.html" style="color: white; display: block; margin: 10px 0;">‚ö° Emotion Balance</a>
                            <a href="salad-compass.html" style="color: white; display: block; margin: 10px 0;">ü•ó Salad Compass</a>
                            <a href="#" onclick="app.navigate('salad');" style="color: white; display: block; margin: 10px 0;">ü•¨ Full Salad Check</a>
                            <a href="#" onclick="app.navigate('interventions');" style="color: white; display: block; margin: 10px 0;">üß∞ Interventions</a>
                        </div>
                    </div>
                    
                    <button class="nav-btn" data-tab="journal">Journal</button>
                    <button class="nav-btn" data-tab="progress">Progress</button>
                </div>
            </nav>

            <!-- Home Tab -->
            <div id="home" class="tab active">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1 id="greeting">Good morning,</h1>
                        <p>Ready to understand and balance your emotional state?</p>
                        <div class="hero-actions">
                            <button class="btn-primary" onclick="app.navigate('assessment')">
                                <i class="fas fa-robot"></i> Start AI Assessment
                            </button>
                            <button class="btn-secondary" onclick="window.location.href='emotion-balance.html'">
                                <i class="fas fa-bolt"></i> Quick Check-In
                            </button>
                        </div>
                    </div>
                    <div class="hero-visual">
                        <div class="mini-cycle" id="miniCycle"></div>
                    </div>
                </div>

                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-value" id="streakValue">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üßò</div>
                        <div class="stat-value" id="sessionValue">0</div>
                        <div class="stat-label">Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value" id="minuteValue">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                </div>

                <!-- Quick Tools Section -->
                <div class="tools-section">
                    <h2 class="section-title">‚ö° Quick Tools</h2>
                    <p class="section-subtitle">Fast check-ins for immediate clarity</p>
                    <div class="feature-grid quick-tools">
                        <div class="feature-card featured" onclick="window.location.href='emotion-balance.html'">
                            <div class="feature-icon balance-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <h3>Emotion Balance</h3>
                            <p>4 sliders, instant score, personalized actions</p>
                            <span class="card-badge">30 seconds</span>
                        </div>
                        <div class="feature-card featured" onclick="window.location.href='salad-compass.html'">
                            <div class="feature-icon compass-icon">
                                <i class="fas fa-compass"></i>
                            </div>
                            <h3>Salad Compass</h3>
                            <p>Identify your state, find the missing vegetable</p>
                            <span class="card-badge">1 minute</span>
                        </div>
                        <div class="feature-card" onclick="window.location.href='emotion-explorer.html'">
                            <div class="feature-icon explorer-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <h3>Emotion Explorer</h3>
                            <p>Build your emotion ribbon visualization</p>
                            <span class="card-badge">Visual</span>
                        </div>
                    </div>
                </div>

                <!-- Deep Work Section -->
                <div class="tools-section">
                    <h2 class="section-title">üß† Deep Work</h2>
                    <p class="section-subtitle">Comprehensive tools for deeper understanding</p>
                    <div class="feature-grid">
                        <div class="feature-card" onclick="app.navigate('assessment')">
                            <div class="feature-icon ai-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <h3>AI Assessment</h3>
                            <p>94% accurate emotion detection with multimodal analysis</p>
                        </div>
                        <div class="feature-card" onclick="app.navigate('cycle')">
                            <div class="feature-icon cycle-icon">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <h3>Power-Possession Cycle</h3>
                            <p>Interactive visualization of your emotional journey</p>
                        </div>
                        <div class="feature-card" onclick="app.navigate('salad')">
                            <div class="feature-icon salad-icon">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <h3>Emotional Salad Check</h3>
                            <p>21-question diagnostic with personalized protocol</p>
                        </div>
                    </div>
                </div>

                <!-- Emergency Section -->
                <div class="tools-section emergency-section">
                    <h2 class="section-title">üÜò Need Relief Now?</h2>
                    <div class="emergency-grid">
                        <div class="emergency-card" onclick="app.navigate('interventions')">
                            <i class="fas fa-toolbox"></i>
                            <span>Micro-Interventions</span>
                            <small>60-second techniques</small>
                        </div>
                        <div class="emergency-card" onclick="app.startIntervention('sigh')">
                            <i class="fas fa-wind"></i>
                            <span>Physiological Sigh</span>
                            <small>Instant calm</small>
                        </div>
                        <div class="emergency-card" onclick="app.startIntervention('54321')">
                            <i class="fas fa-eye"></i>
                            <span>5-4-3-2-1 Grounding</span>
                            <small>Come back to now</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Power-Possession Cycle Tab -->
            <div id="cycle" class="tab">
                <h2>Power-Possession Cycle</h2>
                <p class="section-description">
                    A self-reinforcing emotional pattern: acquisition of external power ‚Üí inevitable loss ‚Üí 
                    collapse into emptiness ‚Üí urgent craving ‚Üí return to power-seeking.
                </p>
                
                <div class="cycle-container">
                    <div class="cycle-visualization" id="cycleVisualization"></div>
                    <div class="cycle-info" id="cycleInfo">
                        <div class="state-detail">
                            <h3>Click on a state to learn more</h3>
                            <p>Explore each phase of the emotional cycle and discover personalized strategies.</p>
                        </div>
                    </div>
                </div>

                <div class="cycle-legend">
                    <div class="legend-item"><span class="legend-color power"></span><span>Power - External validation</span></div>
                    <div class="legend-item"><span class="legend-color possession"></span><span>Possession - Owning phase</span></div>
                    <div class="legend-item"><span class="legend-color loss"></span><span>Loss - Inevitability</span></div>
                    <div class="legend-item"><span class="legend-color emptiness"></span><span>Emptiness - Collapse</span></div>
                    <div class="legend-item"><span class="legend-color craving"></span><span>Craving - Compulsive</span></div>
                    <div class="legend-item"><span class="legend-color return"></span><span>Return - Power-seeking</span></div>
                </div>
            </div>

            <!-- AI Assessment Tab -->
            <div id="assessment" class="tab">
                <h2>AI Emotional Assessment</h2>
                <div class="assessment-container">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="ai-avatar"><i class="fas fa-robot"></i></div>
                            <div class="ai-info">
                                <h3>Emotion AI</h3>
                                <span class="status">Online</span>
                            </div>
                            <div class="accuracy-badge">94% accuracy</div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="message ai-message">
                                <p>Hello! I'm here to help you understand your current emotional state. What's happening for you right now?</p>
                            </div>
                        </div>

                        <div class="chat-input-area">
                            <div class="input-modes">
                                <button class="mode-btn active" data-mode="text"><i class="fas fa-keyboard"></i> Text</button>
                                <button class="mode-btn" data-mode="voice" onclick="app.toggleVoiceInput()"><i class="fas fa-microphone"></i> Voice</button>
                                <button class="mode-btn" data-mode="quiz" onclick="app.startStructuredAssessment()"><i class="fas fa-clipboard-check"></i> Quiz</button>
                                <button class="mode-btn" data-mode="journey" onclick="app.showEmotionJourney()"><i class="fas fa-chart-line"></i> Journey</button>
                            </div>
                            <div class="input-container">
                                <textarea id="chatInput" placeholder="Describe how you're feeling..."></textarea>
                                <button class="send-btn" onclick="app.sendMessage()"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="assessment-sidebar">
                        <div class="detected-state" id="detectedState">
                            <h4>Detected State</h4>
                            <div class="state-placeholder">Start chatting to detect your emotional state</div>
                        </div>
                        <div class="confidence-score" id="confidenceScore">
                            <h4>Confidence</h4>
                            <div class="score-bar"><div class="score-fill" style="width: 0%"></div></div>
                            <span class="score-value">--</span>
                        </div>

                        <div class="suggested-actions" id="suggestedActions">
                            <h4>Suggested Actions</h4>
                            <div class="actions-placeholder">Actions will appear here</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Salad Check Tab -->
            <div id="salad" class="tab">
                <h2>Emotional Salad Check</h2>
                <div style="background: rgba(80, 200, 184, 0.1); border: 1px solid rgba(80, 200, 184, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 30px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <div style="font-weight: 600; color: #50c8b8; margin-bottom: 5px;"><i class="fas fa-compass"></i> Need a quick check-in?</div>
                        <div style="color: #b0b0b8; font-size: 0.95rem;">Use the Salad Plate Compass for instant emotional navigation.</div>
                    </div>
                    <button class="btn-secondary" onclick="window.location.href='salad-compass.html'" style="white-space: nowrap;">
                        <i class="fas fa-compass"></i> Open Compass
                    </button>
                </div>

                <div class="salad-container">
                    <div class="progress-section">
                        <div class="progress-bar"><div class="progress-fill" id="saladProgress"></div></div>
                        <span class="progress-text" id="saladProgressText">Question 1 of 21</span>
                    </div>

                    <div id="saladQuestions"></div>

                    <div id="saladResults" class="hidden">
                        <div class="results-plate">
                            <h3>Your Emotional Salad</h3>
                            <div id="plateContent"></div>
                        </div>
                        <div class="protocol-section">
                            <h3>7-Step Balancing Protocol</h3>
                            <div id="protocolSteps"></div>
                        </div>

                        <button class="btn-primary" onclick="app.resetSalad()">Start New Check</button>
                    </div>
                </div>
            </div>

            <!-- Interventions Tab -->
            <div id="interventions" class="tab">
                <h2>Micro-Interventions</h2>
                <div class="interventions-grid">
                    <div class="intervention-category">
                        <h3><i class="fas fa-fire"></i> Power State</h3>
                        <div class="intervention-list">
                            <div class="intervention-card" onclick="app.startIntervention('grounding')">
                                <span class="duration">60s</span>
                                <h4>Values Grounding</h4>
                                <p>Reconnect with internal values vs external validation</p>
                            </div>
                            <div class="intervention-card" onclick="app.startIntervention('powerbreathing')">
                                <span class="duration">2min</span>
                                <h4>Power Breathing</h4>
                                <p>Channel energy through controlled breath</p>
                            </div>
                        </div>
                    </div>

                    <div class="intervention-category">
                        <h3><i class="fas fa-heart-broken"></i> Loss & Emptiness</h3>
                        <div class="intervention-list">
                            <div class="intervention-card" onclick="app.startIntervention('somatic')">
                                <span class="duration">3min</span>
                                <h4>Somatic Anchoring</h4>
                                <p>Ground through body awareness</p>
                            </div>
                            <div class="intervention-card" onclick="app.startIntervention('reframe')">
                                <span class="duration">2min</span>
                                <h4>Cognitive Reframe</h4>
                                <p>Shift perspective on the loss</p>
                            </div>
                        </div>
                    </div>

                    <div class="intervention-category">
                        <h3><i class="fas fa-fire-alt"></i> Craving Phase</h3>
                        <div class="intervention-list">
                            <div class="intervention-card" onclick="app.startIntervention('urgesurfing')">
                                <span class="duration">5min</span>
                                <h4>Urge Surfing</h4>
                                <p>Ride the wave of craving without acting</p>
                            </div>
                            <div class="intervention-card" onclick="app.startIntervention('patternbreak')">
                                <span class="duration">60s</span>
                                <h4>Pattern Interrupt</h4>
                                <p>Quick-action checklist to break the cycle</p>
                            </div>
                        </div>
                    </div>

                    <div class="intervention-category">
                        <h3><i class="fas fa-bolt"></i> Universal Tools</h3>
                        <div class="intervention-list">
                            <div class="intervention-card" onclick="app.startIntervention('sigh')">
                                <span class="duration">60s</span>
                                <h4>Physiological Sigh</h4>
                                <p>Two inhales, extended exhale</p>
                            </div>
                            <div class="intervention-card" onclick="app.startIntervention('54321')">
                                <span class="duration">60s</span>
                                <h4>5-4-3-2-1 Grounding</h4>
                                <p>Sensory orientation technique</p>
                            </div>
                            <div class="intervention-card" onclick="app.startIntervention('compassion')">
                                <span class="duration">60s</span>
                                <h4>Self-Compassion Break</h4>
                                <p>Acknowledge suffering with kindness</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal Tab -->
            <div id="journal" class="tab">
                <h2>Journal</h2>
                <div class="journal-section">
                    <div class="mood-tracker-card">
                        <h3>How are you feeling?</h3>
                        <div class="mood-scale">
                            <button class="mood-btn" data-mood="1" onclick="app.logMood(1)"><span class="mood-emoji">üò¢</span><span class="mood-label">Sad</span></button>
                            <button class="mood-btn" data-mood="2" onclick="app.logMood(2)"><span class="mood-emoji">üòï</span><span class="mood-label">Down</span></button>
                            <button class="mood-btn" data-mood="3" onclick="app.logMood(3)"><span class="mood-emoji">üòê</span><span class="mood-label">Okay</span></button>
                            <button class="mood-btn" data-mood="4" onclick="app.logMood(4)"><span class="mood-emoji">üôÇ</span><span class="mood-label">Good</span></button>
                            <button class="mood-btn" data-mood="5" onclick="app.logMood(5)"><span class="mood-emoji">üòä</span><span class="mood-label">Great</span></button>
                        </div>
                    </div>

                    <div class="quick-entry-card">
                        <h3>Quick Entry</h3>
                        <p class="prompt" id="journalPrompt">What are you grateful for today?</p>
                        <textarea id="journalText" placeholder="Write your thoughts..."></textarea>
                        <div class="entry-actions">
                            <button class="btn-secondary" onclick="app.newJournalPrompt()">New Prompt</button>
                            <button class="btn-primary" onclick="app.saveJournalEntry()">Save Entry</button>
                        </div>
                    </div>

                    <div id="journalEntries"></div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progress" class="tab">
                <h2>Progress</h2>
                <div class="progress-dashboard">
                    <div class="stats-row">
                        <div class="stat-box">
                            <div class="stat-icon-large">üî•</div>
                            <div class="stat-number" id="progressStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon-large">‚úÖ</div>
                            <div class="stat-number" id="progressSessions">0</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon-large">‚è±Ô∏è</div>
                            <div class="stat-number" id="progressMinutes">0</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3>Weekly Activity</h3>
                        <canvas id="weeklyChart"></canvas>
                    </div>

                    <div class="achievements-card">
                        <h3>Achievements</h3>
                        <div id="achievementsList"></div>
                    </div>

                    <div class="insights-card">
                        <h3>Emotion Journey</h3>
                        <div id="insightsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Intervention Modal -->
        <div id="interventionModal" class="modal hidden">
            <div class="modal-content">
                <div class="intervention-player">
                    <h2 id="interventionTitle">Intervention</h2>
                    <div class="timer-container">
                        <svg viewBox="0 0 100 100" class="timer-svg">
                            <circle class="timer-bg" cx="50" cy="50" r="45"/>
                            <circle class="timer-progress" id="interventionProgress" cx="50" cy="50" r="45"/>
                        </svg>
                        <div class="timer-display" id="interventionTimer">60</div>
                    </div>
                    <div class="intervention-instructions" id="interventionInstructions">Follow the guided practice</div>
                    <div class="timer-controls">
                        <button class="control-btn" id="playPauseBtn" onclick="app.toggleIntervention()"><i class="fas fa-play"></i></button>
                        <button class="control-btn" onclick="app.stopIntervention()"><i class="fas fa-stop"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2026 Mindfulness Therapy. All rights reserved.</p>
            <p class="footer-links">
                <a href="#" onclick="app.navigate('home')">Home</a> |
                <a href="emotion-explorer.html">üé® Emotion Explorer</a> |
                <a href="emotion-balance.html">‚ö° Emotion Balance</a> |
                <a href="salad-compass.html">ü•ó Salad Compass</a> |
                <a href="#" onclick="app.showPrivacyPolicy()">Privacy Policy</a> |
                <a href="#" onclick="app.showTerms()">Terms of Use</a> |
                <a href="index-zh.html">‰∏≠Êñá</a>
            </p>
        </div>
    </footer>

    <script src="app.js"></script>
    
    <!-- Tools Dropdown Script - Completely isolated from app.js -->
    <script>
        // Simple toggle function for inline onclick
        function toggleToolsMenu() {
            var menu = document.getElementById('toolsMenu');
            var btn = document.getElementById('toolsBtn');
            if (!menu) {
                alert('Menu not found!');
                return;
            }
            // Force display with inline style
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
                btn.classList.remove('active');
            } else {
                menu.style.display = 'block';
                btn.classList.add('active');
            }
        }
        
        function closeToolsDropdown() {
            var menu = document.getElementById('toolsMenu');
            var btn = document.getElementById('toolsBtn');
            if (menu) menu.classList.remove('open');
            if (btn) btn.classList.remove('active');
        }
        
        // Close when clicking outside
        document.addEventListener('click', function(e) {
            var container = document.getElementById('toolsContainer');
            if (container && !container.contains(e.target)) {
                closeToolsDropdown();
            }
        });
    </script>
</body>
</html>
